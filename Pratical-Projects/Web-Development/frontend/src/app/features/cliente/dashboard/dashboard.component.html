<!-- NAVBAR FIXA NO TOPO -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
	<div class="container-fluid px-4">
		<a class="navbar-brand fw-bold d-flex align-items-center gap-2" routerLink="/">
	<img src="assets/images/ServeLogo.png" alt="ServePoint Logo" style="height: 40px;" />
	ServePoint
</a>
	<div class="dropdown ms-auto">
		<button
			class="btn btn-outline-secondary dropdown-toggle"
			type="button"
			data-bs-toggle="dropdown"
		>
			👤 {{ utilizador?.nome || "Conta" }}
		</button>
		<ul class="dropdown-menu dropdown-menu-end">
			<li>
				<a class="dropdown-item" [routerLink]="['/cliente/perfil']"
					>📄 Ver Perfil</a
				>
			</li>
			<li>
				<a
					class="dropdown-item"
					[routerLink]="['/cliente/perfil']"
					[queryParams]="{ secao: 'encomendas' }"
				>
					📦 Minhas Encomendas
				</a>
			</li>
			<li><hr class="dropdown-divider" /></li>
			<li>
				<a class="dropdown-item text-danger" (click)="logout()"
					>🚪 Terminar Sessão</a
				>
			</li>
		</ul>
	</div>
	</div>
</nav>

<div class="container py-4">
	<!-- Saudação -->
	<h2 class="mb-3">👋 Olá {{ utilizador?.nome || "Utilizador" }}</h2>
	<p class="text-muted">
		Escolhe um restaurante ou tipo de comida para começares a encomendar.
	</p>

	<!-- Filtros com ícones -->
	<div
		class="d-flex w-100 justify-content-between align-items-center flex-wrap gap-2 mb-4"
	>
		<div class="d-flex flex-wrap gap-2">
			<button
				class="btn"
				[ngClass]="{
          'btn-primary': filtroSelecionado === '',
          'btn-outline-primary': filtroSelecionado !== ''
        }"
				(click)="filtroSelecionado = ''"
			>
				🍽️ Todos
			</button>
			<button
				class="btn"
				[ngClass]="{
          'btn-primary': filtroSelecionado === 'Portuguesa',
          'btn-outline-primary': filtroSelecionado !== 'Portuguesa'
        }"
				(click)="filtroSelecionado = 'Portuguesa'"
			>
				🇵🇹 Portuguesa
			</button>
			<button
				class="btn"
				[ngClass]="{
          'btn-primary': filtroSelecionado === 'Italiana',
          'btn-outline-primary': filtroSelecionado !== 'Italiana'
        }"
				(click)="filtroSelecionado = 'Italiana'"
			>
				🍕 Italiana
			</button>
			<button
				class="btn"
				[ngClass]="{
          'btn-primary': filtroSelecionado === 'Japonesa',
          'btn-outline-primary': filtroSelecionado !== 'Japonesa'
        }"
				(click)="filtroSelecionado = 'Japonesa'"
			>
				🍣 Japonesa
			</button>
			<button
				class="btn"
				[ngClass]="{
          'btn-primary': filtroSelecionado === 'Vegetariana',
          'btn-outline-primary': filtroSelecionado !== 'Vegetariana'
        }"
				(click)="filtroSelecionado = 'Vegetariana'"
			>
				🥗 Vegetariana
			</button>
			<button
				class="btn"
				[ngClass]="{
          'btn-primary': filtroSelecionado === 'Outro',
          'btn-outline-primary': filtroSelecionado !== 'Outro'
        }"
				(click)="filtroSelecionado = 'Outro'"
			>
				🍲 Outro
			</button>
		</div>
		<a
			[routerLink]="['/cliente/mapa']"
			class="btn btn-outline-dark ver-mapa-btn"
		>
			🗺️ Ver Mapa
		</a>
	</div>

	<!-- Restaurantes disponíveis -->
	<h4 class="mb-3">🍽️ Restaurantes disponíveis</h4>

	<div
		*ngIf="restaurantesFiltrados() as listaRestaurantes; else semRestaurantes"
	>
		<div class="row">
			<div
				class="col-md-4 mb-4"
				*ngFor="let restaurante of restaurantesFiltrados()"
			>
				<div class="card h-100 shadow-sm">
					<!-- Imagem de capa -->
					<img
						[src]="
              getImagemCompleta(restaurante.capaUrl) ||
              'https://via.placeholder.com/400x200'
            "
						class="card-img-top"
						alt="Capa de {{ restaurante.nome }}"
						style="height: 180px; object-fit: cover"
					/>

					<div class="card-body d-flex flex-column">
						<!-- Logo + Nome -->
						<div class="d-flex align-items-center mb-2">
							<img
								[src]="
                  getImagemCompleta(restaurante.logoUrl) ||
                  'https://via.placeholder.com/40'
                "
								alt="Logo de {{ restaurante.nome }}"
								class="me-2 rounded-circle border"
								style="width: 40px; height: 40px; object-fit: cover"
							/>
							<h5 class="card-title mb-0">{{ restaurante.nome }}</h5>
						</div>

						<!-- Tipo de cozinha -->
						<p class="text-muted small">{{ restaurante.tipoCozinha }}</p>

						<!-- Classificação e botão -->
						<div
							class="mt-auto d-flex justify-content-between align-items-center"
						>
							<span class="badge bg-success"
								>{{ restaurante.classificacao }} ★</span
							>
							<button
								class="btn btn-sm btn-primary"
								[routerLink]="['/restaurante', restaurante._id]"
							>
								Ver Menu
							</button>
							<button
								class="btn btn-sm btn-outline-secondary"
								(click)="abrirDetalhes(restaurante)"
							>
								ℹ️ Ver Detalhes
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Sem resultados -->
	<ng-template #semRestaurantes>
		<p class="text-muted">
			Nenhum restaurante encontrado com este tipo de cozinha.
		</p>
	</ng-template>

	<!-- Modal de detalhes do restaurante -->
	<div
		class="modal fade"
		id="modalDetalhes"
		tabindex="-1"
		aria-labelledby="modalDetalhesLabel"
		aria-hidden="true"
	>
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5
						class="modal-title d-flex align-items-center gap-2"
						id="modalDetalhesLabel"
					>
						{{ restauranteSelecionado?.nome }}
						<span
							*ngIf="isAbertoAgora(restauranteSelecionado)"
							class="badge bg-success"
						>
							🟢 Aberto agora
						</span>
						<span
							*ngIf="!isAbertoAgora(restauranteSelecionado)"
							class="badge bg-danger"
						>
							🔴 Fechado agora
						</span>
					</h5>
					<button
						type="button"
						class="btn-close"
						data-bs-dismiss="modal"
						aria-label="Fechar"
					></button>
				</div>

				<div class="modal-body">
					<!-- Capa -->
					<img
						[src]="getImagemCompleta(restauranteSelecionado?.capaUrl)"
						alt="Capa"
						class="img-fluid rounded mb-4 shadow-sm"
					/>

					<!-- Dados principais -->
					<div class="row g-4">
						<div class="col-md-6">
							<p>
								<strong>Morada:</strong> {{ restauranteSelecionado?.morada }}
							</p>
							<p>
								<strong>Responsável:</strong>
								{{ restauranteSelecionado?.pessoaResponsavel }}
							</p>
							<p>
								<strong>Telefone:</strong>
								{{ restauranteSelecionado?.telefone }}
							</p>
							<p><strong>NIF:</strong> {{ restauranteSelecionado?.nif }}</p>
							<p>
								<strong>Tipo de Cozinha:</strong>
								{{ restauranteSelecionado?.tipoCozinha }}
							</p>
						</div>
						<div class="col-md-6">
							<p>
								<strong>Tempo de confeção:</strong>
								{{ restauranteSelecionado?.tempoConfecao }} min
							</p>
							<p>
								<strong>Tempo de entrega:</strong>
								{{ restauranteSelecionado?.tempoEntrega }} min
							</p>
							<p>
								<strong>Raio de entrega:</strong>
								{{ restauranteSelecionado?.raioEntregaKm }} km
							</p>
							<p>
								<strong>Encomendas/hora:</strong>
								{{ restauranteSelecionado?.maxEncomendasPorHora }}
							</p>
							<p>
								<strong>Pagamento:</strong>
								<span
									*ngFor="
                    let m of restauranteSelecionado?.metodosPagamento;
                    let i = index
                  "
								>
									{{ m
									}}<span
										*ngIf="
                      i < restauranteSelecionado.metodosPagamento.length - 1
                    "
										>,
									</span>
								</span>
							</p>
						</div>
					</div>

					<!-- Horário -->
					<div
						*ngIf="restauranteSelecionado?.horarioFuncionamento?.length"
						class="mt-4"
					>
						<p><strong>Horário de Funcionamento:</strong></p>
						<ul class="list-group">
							<li
								*ngFor="let h of restauranteSelecionado.horarioFuncionamento"
								class="list-group-item d-flex justify-content-between align-items-center py-2 px-3"
							>
								<span>{{ h.dia }}</span>
								<span class="fw-semibold">
									<ng-container *ngIf="h.fechado; else horario">
										Fechado
									</ng-container>
									<ng-template #horario
										>{{ h.abre }} - {{ h.fecha }}</ng-template
									>
								</span>
							</li>
						</ul>
					</div>

					<!-- Botão para ligar -->
					<a
						*ngIf="restauranteSelecionado?.telefone"
						[href]="'tel:' + restauranteSelecionado.telefone"
						class="btn btn-success w-100 d-flex align-items-center justify-content-center gap-2 mt-4"
					>
						<i class="bi bi-telephone-fill"></i>
						Ligar para {{ restauranteSelecionado.telefone }}
					</a>
				</div>

				<div class="modal-footer">
					<button
						type="button"
						class="btn btn-secondary"
						data-bs-dismiss="modal"
					>
						Fechar
					</button>
				</div>
			</div>
		</div>
	</div>
</div>
