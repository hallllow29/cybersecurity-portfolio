<% layout('layout') %> <% title = menu.nome + ' - Menu Digital' %> <% styles =
`<link href="/stylesheets/menu/detalhesMenu.css" rel="stylesheet" />` %>

<div class="menu-header">
  <h1><%= menu.nome %></h1>
  <% if (menu.descricao) { %>
  <p class="text-muted"><%= menu.descricao %></p>
  <% } %>
</div>

<% for (const categoria in categorias) { %>
<div class="categoria-bloco">
  <div class="categoria-titulo"><%= categoria %></div>

  <% categorias[categoria].forEach(prato => { %>
    <a
    href="#"
    class="text-decoration-none text-dark"
    data-img="<%= prato.imagem %>"
    data-nome="<%= prato.nome %>"
    data-desc="<%= prato.descricao %>"
    data-nutri="<%= prato.infoNutricional %>"
    data-preco="<%= prato.preco %>"
    data-alergenios='<%= JSON.stringify(prato.alergenios || []) %>'
    data-dose='<%= JSON.stringify(prato.tipoDose || []) %>'
    onclick="abrirModal(this)"
  >
    <div class="prato-card">
      <% if (prato.imagem) { %>
      <img src="<%= prato.imagem %>" alt="Imagem do prato" class="prato-img" />
      <% } %>
      <div class="prato-info">
        <div class="prato-nome"><%= prato.nome %></div>
      </div>
      <div class="prato-preco">€<%= prato.preco.toFixed(2) %></div>
    </div>
  </a>
  <% }) %>
</div>
<% } %>

<div class="text-center mt-4">
  <a href="/menu/listar" class="btn btn-voltar px-4">⬅ Voltar</a>
</div>

<div id="modal-prato" class="custom-modal d-none">
  <div class="custom-modal-content">
    <button id="modal-close" class="modal-close-btn">&times;</button>
    <img id="modal-img" src="" alt="Imagem do prato" />
    <h2 id="modal-titulo" class="fw-bold mt-3"></h2>

    <div class="modal-section">
      <h5>📄 <span class="text-laranja">Descrição</span></h5>
      <p id="modal-desc"></p>
    </div>

    <div class="modal-section">
      <h5>🍎 <span class="text-laranja">Informação Nutricional</span></h5>
      <p id="modal-nutri"></p>
    </div>

    <div class="modal-section">
      <h5>⚠️ <span class="text-laranja">Alergénios</span></h5>
      <ul id="modal-alergenios"></ul>
    </div>

    <div class="modal-section">
      <h5>🍽️ <span class="text-laranja">Tipo de Dose</span></h5>
      <ul id="modal-dose"></ul>
    </div>

    <div class="modal-section">
      <h5>💰 <span class="text-laranja">Preço</span></h5>
      <p><strong id="modal-preco"></strong> €</p>
    </div>
  </div>
</div>

<% scripts = `
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function abrirModal(el) {
    document.getElementById("modal-img").src = el.dataset.img;
    document.getElementById("modal-titulo").textContent = el.dataset.nome;
    document.getElementById("modal-desc").textContent =
      el.dataset.desc || "Sem descrição";
    document.getElementById("modal-nutri").textContent =
      el.dataset.nutri || "N/A";
    document.getElementById("modal-preco").textContent = parseFloat(
      el.dataset.preco
    ).toFixed(2);

    const alergUl = document.getElementById("modal-alergenios");
    alergUl.innerHTML = "";
    const alergs = JSON.parse(el.dataset.alergenios || "[]");
    alergs.forEach((a) => {
      const li = document.createElement("li");
      li.textContent = a;
      alergUl.appendChild(li);
    });

    const doseUl = document.getElementById("modal-dose");
    doseUl.innerHTML = "";
    const doses = JSON.parse(el.dataset.dose || "[]");
    doses.forEach((d) => {
      const li = document.createElement("li");
      li.textContent = d;
      doseUl.appendChild(li);
    });

    document.getElementById("modal-prato").classList.remove("d-none");
  }

  document.getElementById("modal-close").addEventListener("click", () => {
    document.getElementById("modal-prato").classList.add("d-none");
  });
</script>
` %>
